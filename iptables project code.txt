If you don’t want pfSense as VM

Then replicate firewalling on VM2 (web) and VM1 (db-mail) with iptables:

On VM2 (only allow web + nagios)
> sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
> sudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT
> sudo iptables -A INPUT -p tcp --dport 5666 -s 192.168.56.115 -j ACCEPT   # NRPE for Nagios  VM1-IP
> sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
> sudo iptables -A INPUT -j DROP

On VM1 (allow mail, db, nagios)
> sudo iptables -A INPUT -p tcp --dport 25 -j ACCEPT   # SMTP
> sudo iptables -A INPUT -p tcp --dport 143 -j ACCEPT  # IMAP
> sudo iptables -A INPUT -p tcp --dport 110 -j ACCEPT  # POP3
> sudo iptables -A INPUT -p tcp --dport 3306 -s 192.168.56.120 -j ACCEPT  # MariaDB only from VM2
> sudo iptables -A INPUT -p tcp --dport 5666 -s 192.168.56.120 -j ACCEPT  # NRPE for Nagios
> sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
> sudo iptables -A INPUT -j DROP


Make permanent:

> sudo apt install -y iptables-persistent
> sudo netfilter-persistent save


⚡ This way your 2-VM setup simulates pfSense rules, without needing a 3rd VM.




